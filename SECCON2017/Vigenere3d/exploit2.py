import sys

"""
In [12]: _l(3, s)
Out[12]: 'DEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz_{}ABC'
"""
def _l(idx, s):
    return s[idx:] + s[:idx]

"""

python Vigenere3d.py SECCON{ABCDEFGHIJKLMNOPQRSTUVWXYZ} abcdefghijklmn

p => SECCON{ABCDEFGHIJKLMNOPQRSTUVWXYZ}
k1 => abcdefghijklmn
k2 => nmlkjihgfedcba
"""
def main(p, k1, k2):
    s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz_{}" # len(s) = 65
    t = [[_l((i + j) % len(s), s) for j in range(len(s))] for i in range(len(s))]
    i1 = 0 # 0,1,2,3,4,5,6,7,8,9,10,11,12,13
    i2 = 0 # 0,1,2,3,4,5,6,7,8,9...13
    c = ""
    for a in p: # a = S,E,C,C,O,N,{,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,},]
        pos_input_p_char = s.find(a)
        pos_input_k1 = s.find(k1[i1])
        pos_input_k1_reversed = s.find(k2[i2])
        
        c += t[pos_input_p_char][pos_input_k1][pos_input_k1_reversed]

        i1 = (i1 + 1) % len(k1) # 14
        i2 = (i2 + 1) % len(k2) # 14
    return c
print main(sys.argv[1], sys.argv[2], sys.argv[2][::-1])

# POR4dnyTLHBfwbxAAZhe}}ocZR3Cxcftw9
# python exploit2.py SECCON{ABCDEFGHIJKLMNOPQRSTUVWXYZ} abcdefghijklmn

# c += "P" => t[18][][??] = P

# POR4dnyTLHBfwbxAAZhe}}ocZR3Cxcftw9

